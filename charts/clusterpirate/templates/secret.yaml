{{- if or (and (not .Values.auth.existingSecret) .Values.auth.accessToken) .Values.clusterPirate.metrics.cache.password }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "clusterpirate.fullname" . }}
  namespace: {{ .Release.Namespace }}
  {{- if .Values.commonAnnotations }}
  annotations:
{{- include "clusterpirate.annotations" . | indent 4 }}
  {{- end }}
  {{- if .Values.commonLabels }}
  labels:
{{- include "clusterpirate.labels" . | indent 4 }}
  {{- end }}
type: Opaque
stringData:
  {{- if .Values.auth.accessToken }}
  accessToken: {{ .Values.auth.accessToken | quote }}
  {{- end }}
  {{- if .Values.clusterPirate.metrics.cache.password }}
  valkeyPassword: {{ .Values.clusterPirate.metrics.cache.password | quote }}
  {{- end }}
{{- else if and (not .Values.auth.existingSecret) (not .Values.auth.accessToken) }}
{{- fail "ERROR: auth.accessToken is required when auth.existingSecret is not set. Please provide auth.accessToken or configure auth.existingSecret." }}
{{- end }}